<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<link rel="stylesheet" href="fonts/fonts.css"><title data-react-helmet="true">Working with Datastructures | pro! documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Working with Datastructures | pro! documentation"><meta data-react-helmet="true" name="description" content="In this section we want to demonstrate how to work with pro! datastructures."><meta data-react-helmet="true" property="og:description" content="In this section we want to demonstrate how to work with pro! datastructures."><meta data-react-helmet="true" property="og:url" content="https://github.com/paritytech/ink/pro-docs/datastructures/hashmap"><link data-react-helmet="true" rel="shortcut icon" href="/pro-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://github.com/paritytech/ink/pro-docs/datastructures/hashmap"><link rel="stylesheet" href="/pro-docs/styles.72dc51c1.css">
<link rel="preload" href="/pro-docs/styles.bffd6a16.js" as="script">
<link rel="preload" href="/pro-docs/runtime~main.b5c8fe83.js" as="script">
<link rel="preload" href="/pro-docs/main.5b6660b8.js" as="script">
<link rel="preload" href="/pro-docs/1.d5f44af2.js" as="script">
<link rel="preload" href="/pro-docs/2.e392b2d8.js" as="script">
<link rel="preload" href="/pro-docs/57.3a5cf41c.js" as="script">
<link rel="preload" href="/pro-docs/935f2afb.d7e0b259.js" as="script">
<link rel="preload" href="/pro-docs/17896441.65c2475b.js" as="script">
<link rel="preload" href="/pro-docs/8ad8a65c.d23da7ae.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/pro-docs/"><img class="navbar__logo" src="/pro-docs/img/logo-black.svg" alt="pro!"><strong class="navbar__title"></strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/paritytech/ink" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">pro! GitHub</a><a href="https://github.com/paritytech/pro-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Docs GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/pro-docs/"><img class="navbar__logo" src="/pro-docs/img/logo-black.svg" alt="pro!"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/paritytech/ink" target="_blank" rel="noopener noreferrer" class="menu__link">pro! GitHub</a></li><li class="menu__list-item"><a href="https://github.com/paritytech/pro-docs" target="_blank" rel="noopener noreferrer" class="menu__link">Docs GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Overview</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/why-rust-for-smart-contracts">Why Rust for Smart Contracts?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/why-webassembly-for-smart-contracts">Why WebAssembly for Smart Contracts?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/how-it-works">How it Works â€’ Substrate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/ink-vs-solidity">pro! vs. Solidity</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/getting-started/setup">Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/getting-started/creating-an-ink-project">Creating an pro! Project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/getting-started/building-your-contract">Compile Your Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/getting-started/running-substrate">Run a Substrate Node</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/getting-started/deploy-your-contract">Deploy Your Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/getting-started/calling-your-contract">Call Your Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/getting-started/troubleshooting">Troubleshooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/basics/contract-template">Contract Template</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/basics/storing-values">Storing Values</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/basics/reading-values">Reading Values from Storage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/basics/mutating-values">Mutating Storage Values</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/basics/events">Events</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/basics/trait-definitions">Trait Definitions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/basics/cross-contract-calling">Cross-Contract Calling</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/basics/contract-testing">Contract Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/basics/environment-functions">Environment Functions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Macros &amp; Attributes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes/contract">#[ink::contract]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes/anonymous">#[ink(anonymous)]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes/constructor">#[ink(constructor)]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes/event">#[ink(event)]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes/impl">#[ink(impl)]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes/message">#[ink(message)]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes/namespace">#[ink(namespace = &quot;â€¦&quot;)]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes/payable">#[ink(payable)]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes/selector">#[ink(selector = &quot;â€¦&quot;)]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes/storage">#[ink(storage)]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes/topic">#[ink(topic)]</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/macros-attributes/chain-extension">#[ink::chain_extension]</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Storage &amp; Data Structures</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pro-docs/datastructures/overview">Overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/pro-docs/datastructures/hashmap">Working with Datastructures</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pro-docs/datastructures/spread-packed-layout">Spread vs. Packed</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pro-docs/datastructures/opting-out">Opt out of Storage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pro-docs/datastructures/dynamic-allocation">Dynamic Storage Allocator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/pro-docs/datastructures/custom-datastructure">Custom Datastructures</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Examples</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/examples">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">cargo-contract CLI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/cargo-contract-cli">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Canvas Test Network</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/canvas">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">FAQ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/pro-docs/faq">Frequently Asked Questions</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Working with Datastructures</h1></header><div class="markdown"><p>In this section we want to demonstrate how to work with pro! datastructures.
We will do this using the example of our <code>HashMap</code>, which allows you to store items in a key-value mapping.</p><p>Here is an example of a mapping from user to a number:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#2a2734;color:#9a86fd"><div class="token-line" style="color:#9a86fd"><span class="token plain">#[ink(storage)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">pub struct MyContract {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    // Store a mapping from AccountIds to a u32</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    my_number_map: ink_storage::collections::HashMap&lt;AccountId, u32&gt;,</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">}</span></div></div></div></div></div><p>This means that for a given key, you can store a unique instance of a value type. In this case, each &quot;user&quot; gets their own number, and we can build logic so that only they can modify their own number.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="storage-hashmap-api"></a>Storage HashMap API<a aria-hidden="true" tabindex="-1" class="hash-link" href="#storage-hashmap-api" title="Direct link to heading">#</a></h2><p>You can find the full HashMap API in the <a href="https://paritytech.github.io/ink/ink_storage/collections/hashmap/index.html" target="_blank" rel="noopener noreferrer">crate documentation</a> part of pro!.</p><p>Here are some of the most common functions you might use:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#2a2734;color:#9a86fd"><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// Inserts a key-value pair into the map.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    </span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// Returns the previous value associated with the same key if any.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// If the map did not have this key present, `None` is returned.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    pub fn insert(&amp;mut self, key: K, new_value: V) -&gt; Option&lt;V&gt; {/* --snip-- */}</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// Removes the key/value pair from the map associated with the given key.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    ///</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// - Returns the removed value if any.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    pub fn take&lt;Q&gt;(&amp;mut self, key: &amp;Q) -&gt; Option&lt;V&gt; {/* --snip-- */}</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// Returns a shared reference to the value corresponding to the key.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    ///</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// The key may be any borrowed form of the map&#x27;s key type,</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// but `Hash` and `Eq` on the borrowed form must match those for the key type.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    pub fn get&lt;Q&gt;(&amp;self, key: &amp;Q) -&gt; Option&lt;&amp;V&gt; {/* --snip-- */}</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// Returns a mutable reference to the value corresponding to the key.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    ///</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// The key may be any borrowed form of the map&#x27;s key type,</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// but `Hash` and `Eq` on the borrowed form must match those for the key type.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    pub fn get_mut&lt;Q&gt;(&amp;mut self, key: &amp;Q) -&gt; Option&lt;&amp;mut V&gt; {/* --snip-- */}</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// Returns `true` if there is an entry corresponding to the key in the map.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    pub fn contains_key&lt;Q&gt;(&amp;self, key: &amp;Q) -&gt; bool {/* --snip-- */}</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// Converts the OccupiedEntry into a mutable reference to the value in the entry</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// with a lifetime bound to the map itself.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    pub fn into_mut(self) -&gt; &amp;&#x27;a mut V {/* --snip-- */}</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// Gets the given key&#x27;s corresponding entry in the map for in-place manipulation.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    pub fn entry(&amp;mut self, key: K) -&gt; Entry&lt;K, V&gt; {/* --snip-- */}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="initializing-a-hashmap"></a>Initializing a HashMap<a aria-hidden="true" tabindex="-1" class="hash-link" href="#initializing-a-hashmap" title="Direct link to heading">#</a></h2><p>Not initializing storage before you use it is a common error that can break your smart contract. For each key in a storage value, the value needs to be set before you can use it. To do this, we will create a private function which handles when the value is set and when it is not, and make sure we never work with uninitialized storage.</p><p>So given <code>my_number_map</code>, imagine we wanted the default value for any given key to be <code>0</code>. We can build a function like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#2a2734;color:#9a86fd"><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">use ink_lang as ink;</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">#[ink::contract]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">mod mycontract {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    #[ink(storage)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    pub struct MyContract {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        // Store a mapping from AccountIds to a u32</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        my_number_map: ink_storage::collections::HashMap&lt;AccountId, u32&gt;,</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    impl MyContract {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        /// Public function.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        /// Default constructor.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        #[ink(constructor)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        pub fn default() -&gt; Self {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">            Self {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">                my_number_map: Default::default(),</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">            }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    </span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        /// Private function.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        /// Returns the number for an AccountId or 0 if it is not set.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        fn my_number_or_zero(&amp;self, of: &amp;AccountId) -&gt; u32 {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">            let balance = self.my_number_map.get(of).unwrap_or(&amp;0);</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">            *balance</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">}</span></div></div></div></div></div><p>Here we see that after we <code>get</code> the value from <code>my_number_map</code> we call <code>unwrap_or</code> which will either <code>unwrap</code> the value stored in storage, <em>or</em> if there is no value, return some known value. Then, when building functions that interact with this HashMap, you need to always remember to call this function rather than getting the value directly from storage.</p><p>Here is an example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#2a2734;color:#9a86fd"><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">use ink_lang as ink;</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">#[ink::contract]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">mod mycontract {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    #[ink(storage)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    pub struct MyContract {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        // Store a mapping from AccountIds to a u32</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        my_number_map: ink_storage::collections::HashMap&lt;AccountId, u32&gt;,</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    impl MyContract {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        // Get the value for a given AccountId</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        #[ink(message)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        pub fn get(&amp;self, of: AccountId) -&gt; u32 {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">            self.my_number_or_zero(&amp;of)</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        // Get the value for the calling AccountId</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        #[ink(message)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        pub fn get_my_number(&amp;self) -&gt; u32 {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">            let caller = self.env().caller();</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">            self.my_number_or_zero(&amp;caller)</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        // Returns the number for an AccountId or 0 if it is not set.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        fn my_number_or_zero(&amp;self, of: &amp;AccountId) -&gt; u32 {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">            let value = self.my_number_map.get(of).unwrap_or(&amp;0);</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">            *value</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="contract-caller"></a>Contract Caller<a aria-hidden="true" tabindex="-1" class="hash-link" href="#contract-caller" title="Direct link to heading">#</a></h2><p>As you might have noticed in the example above, we use a special function called <code>self.env().caller()</code>. This function is available throughout the contract logic and will always return to you the contract caller.</p><blockquote><p><strong>NOTE:</strong> The contract caller is not the same as the origin caller. If a user triggers a contract which then calls a subsequent contract, the <code>self.env().caller()</code> in the second contract will be the address of the first contract, not the original user.</p></blockquote><p><code>self.env().caller()</code> can be used a number of different ways. In the examples above, we are basically creating an &quot;access control&quot; layer which allows a user to modify their own value, but no one else. You can also do things like define a contract owner during contract deployment:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#2a2734;color:#9a86fd"><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">#![cfg_attr(not(feature = &quot;std&quot;), no_std)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">use ink_lang as ink;</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">#[ink::contract]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">mod mycontract {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    #[ink(storage)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    pub struct MyContract {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        // Store a contract owner</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        owner: AccountId,</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    impl MyContract {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        #[ink(constructor)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        pub fn new(init_value: i32) -&gt; Self {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">            Self {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">                owner: Self::env().caller();</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">            }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        /* --snip-- */</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">}</span></div></div></div></div></div><p>Then you can write permissioned functions which checks that the current caller is the owner of the contract.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="modifying-a-hashmap"></a>Modifying a HashMap<a aria-hidden="true" tabindex="-1" class="hash-link" href="#modifying-a-hashmap" title="Direct link to heading">#</a></h2><p>Making changes to the value of a HashMap is just as sensitive as getting the value. If you try to modify some value before it has been initialized, your contract will panic!</p><p>But have no fear, we can continue to use the <code>my_number_or_zero</code> function we created to protect us from these situations!</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#2a2734;color:#9a86fd"><div class="token-line" style="color:#9a86fd"><span class="token plain">impl MyContract {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /* --snip-- */</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// Set the value for the calling AccountId</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    #[ink(message)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    pub fn set_my_number(&amp;mut self, value: u32) {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        let caller = self.env().caller();</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        self.my_number_map.insert(caller, value);</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// Add a value to the existing value for the calling AccountId</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    #[ink(message)]</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    pub fn add_my_number(&amp;mut self, value: u32) {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        let caller = self.env().caller();</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        let my_number = self.my_number_or_zero(&amp;caller);</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        self.my_number_map.insert(caller, my_number + value);</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    /// Returns the number for an AccountId or 0 if it is not set.</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    fn my_number_or_zero(&amp;self, of: &amp;AccountId) -&gt; u32 {</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">        *self.my_number_map.get(of).unwrap_or(&amp;0)</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    }</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">}</span></div></div></div></div></div><p>Here we have written two kinds of functions which modify a <code>HashMap</code>.
One which simply inserts the value directly into storage, with no need
to read the value first, and the other which modifies the existing value.
Note how we can always <code>insert</code> the value without worry, as that initialized
the value in storage, but before you can get or modify anything, we need
to call <code>my_number_or_zero</code> to make sure we are working with a real value.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="entry-api"></a>Entry API<a aria-hidden="true" tabindex="-1" class="hash-link" href="#entry-api" title="Direct link to heading">#</a></h2><p>We will not always have an existing value on our contract&#x27;s storage.
We can take advantage of the Rust <code>Option&lt;T&gt;</code> type to help use on this task.
If there&#x27;s no value on the contract storage we will insert a new one; on
the contrary if there is an existing value we will only update it.</p><p>pro! HashMaps expose the well-known <code>entry</code> API that we can use to achieve
this type of &quot;upsert&quot; behavior:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#2a2734;color:#9a86fd"><div class="token-line" style="color:#9a86fd"><span class="token plain">let caller = self.env().caller();</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">self.my_number_map</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    .entry(caller)</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    .and_modify(|old_value| old_value += by)</span></div><div class="token-line" style="color:#9a86fd"><span class="token plain">    .or_insert(by);</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/pro-docs/edit/master/docs/datastructures/hashmap.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/pro-docs/datastructures/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/pro-docs/datastructures/spread-packed-layout"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Spread vs. Packed Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#storage-hashmap-api" class="table-of-contents__link">Storage HashMap API</a></li><li><a href="#initializing-a-hashmap" class="table-of-contents__link">Initializing a HashMap</a></li><li><a href="#contract-caller" class="table-of-contents__link">Contract Caller</a></li><li><a href="#modifying-a-hashmap" class="table-of-contents__link">Modifying a HashMap</a></li><li><a href="#entry-api" class="table-of-contents__link">Entry API</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/pro-docs/styles.bffd6a16.js"></script>
<script src="/pro-docs/runtime~main.b5c8fe83.js"></script>
<script src="/pro-docs/main.5b6660b8.js"></script>
<script src="/pro-docs/1.d5f44af2.js"></script>
<script src="/pro-docs/2.e392b2d8.js"></script>
<script src="/pro-docs/57.3a5cf41c.js"></script>
<script src="/pro-docs/935f2afb.d7e0b259.js"></script>
<script src="/pro-docs/17896441.65c2475b.js"></script>
<script src="/pro-docs/8ad8a65c.d23da7ae.js"></script>
</body>
</html>